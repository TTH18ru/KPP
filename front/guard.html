<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сайт охраны</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .student {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 5px 0;
    }
    </style>
</head>
<body>
<h1>Данные ученика</h1>
<div id="output"></div>
<button id="open-shift">Открыть смену</button>


 <button id="getCurrentStudentsCount">Кол-во студентов в техникуме:</button>
    <div id="result"></div>


  <div class="container">
    <h1>Список студентов</h1>
    
    <!-- Блок выбора группы -->
    <div class="form-section">
      <label for="group-select">Выберите группу:</label>
      <select id="group-select">
        <option value="">-- Выберите группу --</option>
        <option value="П-21">П-21</option>
        <option value="П-31">П-31</option>
        <option value="П-41">П-41</option>
      </select>
      <button id="load-students-btn">Показать студентов</button>
    </div>
    
    <!-- Блок вывода данных студентов располагается ниже формы -->
    <div id="result"></div>
  </div>

 <h1>Запрос данных о посещении</h1>
    <label for="date">Дата:</label>
    <input type="date" id="date" required>
    
    <label for="username">Никнейм:</label>
    <input type="text" id="username" required>
    
    <button onclick="fetchLogData()">Получить данные</button>
    
    <h2>Результаты:</h2>
    <pre id="results"></pre>
<script>

 fetch('/guard/data', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => {
  console.log(data);
  // отобразить данные на странице
  const output = document.getElementById('output');
  output.innerHTML = '';
  for (const key in data.received) {
    const paragraph = document.createElement('p');
    paragraph.textContent = `${key}: ${data.received[key]}`;
    output.appendChild(paragraph);
  }
})
.catch(error => console.error('Ошибка:', error));


document.getElementById('getCurrentStudentsCount').addEventListener('click', () => {
    fetch('/current-students-count', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Ошибка сети');
        }
        return response.json();
    })
    .then(data => {
        document.getElementById('result').innerText = `Количество студентов на территории: ${data.currentStudentsCount}`;
    })
    .catch(error => {
        console.error('Ошибка:', error);
        document.getElementById('result').innerText = 'Произошла ошибка при получении данных.';
    });
});


document.getElementById('open-shift').addEventListener('click', () => {
  fetch('/open-shift', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ${token}'
    }
  })
  .then(response => response.json())
  .then(data => {
    console.log(data);
  })
  .catch(error => {
    console.error(error);
  });
});

 const groupSelect = document.getElementById('group-select');
    const loadStudentsBtn = document.getElementById('load-students-btn');
    const resultDiv = document.getElementById('result');

    // Обработка клика по кнопке "Показать студентов"
    loadStudentsBtn.addEventListener('click', function() {
      const selectedGroup = groupSelect.value;
      
      // Очищаем предыдущие результаты
      resultDiv.innerHTML = '';

      if (!selectedGroup) {
        resultDiv.innerHTML = '<p>Пожалуйста, выберите группу</p>';
        return;
      }

      // Отправляем запрос на сервер для получения студентов выбранной группы
      fetch('/group', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ group: selectedGroup })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Ошибка получения студентов");
        }
        return response.json();
      })
      .then(data => {
        if (data.length === 0) {
          resultDiv.innerHTML = '<p>Студенты в данной группе не найдены.</p>';
          return;
        }
        // Выводим полученных студентов, добавляя каждый в блок resultDiv
        data.forEach(student => {
          const studentDiv = document.createElement('div');
          studentDiv.classList.add('student');
          studentDiv.innerHTML = `
            <p><strong>ФИО:</strong> ${student.surname} ${student.name} ${student.patronymic}</p>
            <p><strong>Дата рождения:</strong> ${student.dob}</p>
            <p><strong>Группа:</strong> ${student.class}</p>
            <p><strong>Username:</strong> ${student.username}</p>
          `;
          resultDiv.appendChild(studentDiv);
        });
      })
      .catch(error => {
        console.error(error);
        resultDiv.innerHTML = '<p>Произошла ошибка при получении данных студентов.</p>';
      });
    });

    async function fetchLogData() {
            const date = document.getElementById('date').value;
            const username = document.getElementById('username').value;

            const response = await fetch('/get-log-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ date, username }),
            });

            const data = await response.json();
            document.getElementById('results').textContent = JSON.stringify(data, null, 2);
        }
  </script>
</script>
</body>
</html>